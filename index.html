<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Capicoin Mini App</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body { font-family: Arial; padding: 20px; background: #f5f5f5; }
    button { margin: 10px 0; padding: 10px 20px; font-size: 16px; }
    #balance { font-weight: bold; font-size: 18px; color: gold; }
    .pack-btn { background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; }
    .pack-unavailable { background: #ccc; cursor: not-allowed; }
    #packs-container { margin-top: 10px; }
  </style>
</head>
<body>
  <h2>ü™ô Capicoin Mini App</h2>
  <div id="balance">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
  <button onclick="getBalance()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å –±–∞–ª–∞–Ω—Å</td>
  <hr>
  <h3>üõí –î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–∞–∫–∏:</h3>
  <div id="packs-container">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–∞–∫–æ–≤...</div>
  <hr>
  <h3>üéÆ –ò–≥—Ä—ã:</h3>
  <button onclick="openBot()">–û—Ç–∫—Ä—ã—Ç—å –∏–≥—Ä—ã –≤ –±–æ—Ç–µ</button>

  <script>
    const tg = window.Telegram.WebApp;
    tg.expand();
    tg.MainButton.hide();

    const API_URL = "https://your-domain.com/api/products"; // ‚Üê –ó–ê–ú–ï–ù–ò–¢–ï –ù–ê –í–ê–® –†–ï–ê–õ–¨–ù–´–ô URL

    function sendData(data) {
      tg.sendData(JSON.stringify(data));
    }

    function getBalance() {
      sendData({ action: "get_balance" });
    }

    function buyPack(packKey) {
      if (confirm(`–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–æ–∫—É–ø–∫—É –ø–∞–∫–∞ "${packKey}"?`)) {
        sendData({ action: "buy", pack: packKey });
      }
    }

    async function loadPacks() {
      try {
        const res = await fetch(API_URL);
        const packs = await res.json();
        const container = document.getElementById("packs-container");
        if (Object.keys(packs).length === 0) {
          container.innerHTML = "<p>‚ùå –ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–∞–∫–æ–≤.</p>";
          return;
        }
        let html = "";
        for (const [key, info] of Object.entries(packs)) {
          html += `
            <button class="pack-btn" onclick="buyPack('${key}')">
              ${info.title} ‚Äî ${info.price} ü™ô
            </button><br>
          `;
        }
        container.innerHTML = html;
      } catch (err) {
        console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–∞–∫–æ–≤:", err);
        document.getElementById("packs-container").innerHTML = 
          "<p>‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–∞–∫–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.</p>";
      }
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    getBalance();
    loadPacks();
  </script>
</body>
</html>
